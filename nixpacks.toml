[phases.setup]
nixPkgs = ["nodejs_22", "wget"]

[phases.install]
cmds = [
    "npm ci --prefer-offline --no-audit",
    # Installation manuelle de Caddy pour Ã©viter les conflits de paquets Nix
    "wget -qO caddy \"https://caddyserver.com/api/download?os=linux&arch=amd64\"",
    "chmod +x caddy"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "./caddy run --config Caddyfile --adapter caddyfile 2>&1"
